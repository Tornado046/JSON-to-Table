<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>JSON ‚Üí Tabla M√≥vil Friendly</title>

<style>
:root {
  --bg-color: #fff; --text-color: #000;
  --cell-even: #f9f9f9; --cell-odd: #e8f0ff;
  --header-bg: #f2f2f2; --header-color: #111;
}
body.dark {
  --bg-color: #1e1e1e; --text-color: #eee;
  --cell-even: #2a2a2a; --cell-odd: #262626;
  --header-bg: #333; --header-color: #eee;
}
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--text-color); background: var(--bg-color);
  display:flex; flex-direction:column; min-height:100vh;
  transition: background 0.3s, color 0.3s;
}
.row { display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin:5px 10px; }
button, input, select { padding:6px 12px; border-radius:6px; border:1px solid #bbb; background:#fafafa; cursor:pointer; font-size:14px; transition:all 0.3s; }
body.dark button, body.dark input, body.dark select { background:#2a2a2a; color:#eee; border:1px solid #666; }
input, select { flex:1; min-width:120px; }
textarea { width:100%; font-family: monospace; padding:10px; border-radius:6px; font-size:14px; }
body.dark textarea { background:#2a2a2a; color:#eee; border:1px solid #666; }
#tabs { display:flex; border-bottom:1px solid #ccc; margin:5px 10px; }
.tab { flex:1; text-align:center; padding:8px 0; cursor:pointer; border-radius:6px 6px 0 0; background:#f2f2f2; }
body.dark .tab { background:#333; color:#eee; }
.tab.active { background:#d9edf7; font-weight:bold; }
#content > div { display:none; padding:10px; flex:1; overflow:auto; }
#content > div.active { display:block; }
#tableWrap { overflow:auto; max-height:50vh; }
table { border-collapse:collapse; font-family:monospace; font-size:12px; min-width:500px; width:100%; }
th, td { border:1px solid #ccc; padding:6px 8px; white-space:nowrap; }
th { position:sticky; top:0; background:var(--header-bg); color:var(--header-color); cursor:pointer; z-index:2; }
tr:nth-child(even) td { background:var(--cell-even); }
tr:nth-child(odd) td { background:var(--cell-odd); }
tr:hover td { background:#fff2cc; }
#rawDisplay { height:200px; overflow:auto; font-family:monospace; white-space:pre; border:1px solid #bbb; border-radius:6px; }
body.dark #rawDisplay { background:#2a2a2a; color:#eee; border:1px solid #666; }
#copyMsg { position:fixed; top:10px; left:10px; background:#d9edf7; padding:6px 10px; border-radius:6px; font-size:12px; display:none; z-index:9999; }
body.dark #copyMsg { background:#444; color:#fff; }
@media(max-width:600px){
  button, input, select { font-size:12px; padding:4px 8px; }
  textarea { font-size:12px; }
  table { font-size:11px; }
}
</style>
</head>

<body>
<div class="row">
  <input type="text" id="urlIn" placeholder="Pega URL aqu√≠...">
  <button id="fetchBtn">üì° Cargar URL</button>
  <button id="configBtn">‚öôÔ∏è Config</button>
</div>

<div id="tabs">
  <div class="tab active" data-tab="jsonTab">JSON</div>
  <div class="tab" data-tab="tableTab">Tabla</div>
  <div class="tab" data-tab="rawTab">Raw</div>
</div>

<div id="content">
  <div id="jsonTab" class="active">
    <textarea id="jsonin" placeholder="Pega JSON aqu√≠"></textarea>
    <button id="clearBtn">Limpiar JSON</button>
  </div>
  <div id="tableTab">
    <div id="tableWrap"></div>
    <div class="row">
      <label>Separador:</label>
      <select id="separatorSelect">
        <option value="	">Tab</option>
        <option value=";">;</option>
        <option value=",">,</option>
      </select>
      <select id="downloadSelect">
        <option value="">Descargar...</option>
        <option value="csv">CSV</option>
        <option value="xlsx">XLSX</option>
        <option value="txt">TXT</option>
      </select>
      <button id="copyBtn">Copiar tabla</button>
      <button id="toggleEditBtn">‚úèÔ∏è Editar</button>
    </div>
    <div class="row">
      <input id="globalFilter" class="globalFilter" placeholder="Buscar en toda la tabla...">
      <span id="globalClearBtn" class="globalClearBtn">‚úï</span>
    </div>
  </div>
  <div id="rawTab">
    <textarea id="rawDisplay" readonly></textarea>
  </div>
</div>

<div id="copyMsg">Copiado al portapapeles</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
// --------------------- TABS ---------------------
const tabs = document.querySelectorAll('.tab');
const contents = document.querySelectorAll('#content > div');
tabs.forEach(tab=>{
  tab.addEventListener('click', ()=>{
    tabs.forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    contents.forEach(c=>c.classList.remove('active'));
    document.getElementById(tab.dataset.tab).classList.add('active');
  });
});

// --------------------- JSON / Tabla / Raw ---------------------
const jsonin = document.getElementById('jsonin');
const tableWrap = document.getElementById('tableWrap');
const rawDisplay = document.getElementById('rawDisplay');
const copyBtn = document.getElementById('copyBtn');
const separatorSelect = document.getElementById('separatorSelect');
const downloadSelect = document.getElementById('downloadSelect');
const toggleEditBtn = document.getElementById('toggleEditBtn');
const globalFilter = document.getElementById('globalFilter');
const globalClearBtn = document.getElementById('globalClearBtn');
let currentRows=[], currentHeaders=[], editing=false;

function isObj(x){ return x && typeof x==='object' && !Array.isArray(x); }
function flattenObject(obj,prefix='',out={}) {
  if(Array.isArray(obj)){ out[prefix.slice(0,-1)||'array']=JSON.stringify(obj); return out; }
  for(const k of Object.keys(obj||{})){
    const v=obj[k], key=prefix+k+'.';
    if(isObj(v)) flattenObject(v,key,out);
    else if(Array.isArray(v)) out[key.slice(0,-1)] = JSON.stringify(v);
    else out[key.slice(0,-1)] = v;
  }
  return out;
}
function getRowsFromJson(parsed){
  if(Array.isArray(parsed)) return parsed.map(o => flattenObject(o));
  for(const k of Object.keys(parsed)){
    if(Array.isArray(parsed[k])) return parsed[k].map(o=>flattenObject(o));
  }
  return [flattenObject(parsed)];
}
function parseJsonInput(){
  let parsed;
  try { parsed = JSON.parse(jsonin.value); }
  catch(e){ tableWrap.innerHTML=''; return; }
  currentRows = getRowsFromJson(parsed);
  const allKeys = new Set();
  currentRows.forEach(r=>Object.keys(r).forEach(k=>allKeys.add(k)));
  currentHeaders = Array.from(allKeys);
  renderTable();
  updateRaw();
}
function renderTable(){
  tableWrap.innerHTML='';
  if(!currentRows.length) return;
  const tbl = document.createElement('table');
  const thead = document.createElement('thead');
  const trh = document.createElement('tr');
  currentHeaders.forEach(h=>{
    const th = document.createElement('th');
    th.textContent=h; th.style.minWidth='80px';
    th.addEventListener('click', ()=>sortColumn(h));
    trh.appendChild(th);
  });
  thead.appendChild(trh);
  tbl.appendChild(thead);
  const tbody = document.createElement('tbody');
  currentRows.forEach(r=>{
    const tr=document.createElement('tr');
    currentHeaders.forEach(h=>{
      const td=document.createElement('td');
      td.textContent=r[h]!==undefined?r[h]:'';
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  tbl.appendChild(tbody);
  tableWrap.appendChild(tbl);
}
function sortColumn(header){
  currentRows.sort((a,b)=>String(a[header]||'').localeCompare(String(b[header]||'')));
  renderTable();
}
function rowsToCsv(rows,sep){
  if(!rows.length) return '';
  const headers = Object.keys(rows[0]);
  const lines=[headers.join(sep)];
  rows.forEach(r=>{
    lines.push(headers.map(h=>String(r[h]||'')).join(sep));
  });
  return lines.join('\n');
}
function updateRaw(){ rawDisplay.value = jsonin.value; }
function copyTable(){
  if(!currentRows.length) return;
  const tbl = tableWrap.querySelector('table');
  if(!tbl) return;
  const range = document.createRange();
  range.selectNode(tbl);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
  document.execCommand('copy');
  sel.removeAllRanges();
  const msg = document.getElementById('copyMsg');
  msg.style.display='block';
  setTimeout(()=>msg.style.display='none',800);
}

// --------------------- EVENTOS ---------------------
jsonin.addEventListener('input', parseJsonInput);
document.getElementById('clearBtn').addEventListener('click', ()=>{ jsonin.value=''; parseJsonInput(); });
copyBtn.addEventListener('click', copyTable);
globalFilter.addEventListener('input', ()=>{
  const val = globalFilter.value.toLowerCase();
  currentRows.forEach((r,i)=>{
    const tr = tableWrap.querySelectorAll('tbody tr')[i];
    tr.style.display = currentHeaders.some(h=>String(r[h]||'').toLowerCase().includes(val))?'':'none';
  });
});
globalClearBtn.addEventListener('click', ()=>{ globalFilter.value=''; globalFilter.dispatchEvent(new Event('input')); });
toggleEditBtn.addEventListener('click', ()=>{ editing=!editing; tableWrap.querySelectorAll('td').forEach(td=>td.contentEditable=editing); });
</script>
</body>
</html>
